{% load filters %}
<div class="comment-card" id="comment-{{ comment.id }}" data-comment-id="{{ comment.id }}">
    <div class="comment-header">
        <a href="{% if comment.user.avatar %}{{ comment.user.avatar.url }}{% else %}/media/avatars/avatar.png{% endif %}" data-lightbox="models" data-title="Ð­Ñ‚Ð¾ Ð°Ð²Ð°Ñ‚Ð°Ñ€ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ">
            <img src="{% if comment.user.avatar %}{{ comment.user.avatar.url }}{% else %}/media/avatars/avatar.png{% endif %}" alt="Ð°Ð²Ð°Ñ‚Ð°Ñ€" class="thumbnail">
        </a>
        <div class="comment-meta">{{ comment.user.username }} | <span>{{ comment.created_at|date:"d M Y" }}</span></div>
    </div>
    <div class="comment-text">{{ comment.text|safe }}</div>

    {% if comment.image %}
    {% if comment.image.name|endswith:".txt" %}
        <div class="comment-file">
            <a href="{{ comment.image.url }}" download>
                ðŸ“„Download text file
            </a>
        </div>
    {% else %}
        <div class="comment-image">
            <a href="{{ comment.image.url }}" data-lightbox="models" data-title="Ð­Ñ‚Ð¾ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð² ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸">
                <img src="{{ comment.image.url }}" alt="Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð² ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸" class="comment-img">
            </a>
        </div>
    {% endif %}
{% endif %}


    <div class="comment-actions">
        {% if user.is_authenticated %}
        <button class="reply-btn" data-parent-id="{{ comment.id }}">Reply</button>
        {% else %}
       <!-- Ð•ÑÐ»Ð¸ Ð½Ðµ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½ â€” Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð¼Ð¾Ð´Ð°Ð»ÐºÑƒ Ð²Ñ…Ð¾Ð´Ð° -->
            <button class="" onclick="document.getElementById('loginModal').style.display='block'">Reply</button>
        {% endif %}
        {% if comment.replies.exists%}
        <button hx-get="{% url 'comment:load_replies' comment_id=comment.id %}?page=1&initial_load=true"
                hx-target="#replies-container-{{ comment.id }}"
                hx-swap="innerHTML"
                class="show-replies-btn" onclick="toggleReplies(this)">
            Show replies
            {% if comment.replies.count > 0 %}
                ({{ comment.replies.count }})
            {% endif %}
        </button>
        {% endif %}
        
    </div>

    <div id="replies-container-{{ comment.id }}" style="display: none;">
        </div>
</div>
